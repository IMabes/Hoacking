<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Hoacking</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/page.css">
    <link rel="stylesheet" href="css/profile.css">
</head>
<body class="profile-body">
    <script src="js/includes.js"></script>
    <script src="js/activity-tracker.js"></script>
    <div id="navbar"></div>
    <div id="blob"></div>
    
    <div class="profile-container">
        <!-- User Header Section -->
        <div class="profile-header">
            <div class="profile-avatar-container">
                <div class="profile-avatar">
                    <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="60" cy="60" r="60" fill="url(#avatarGradient)"/>
                        <circle cx="60" cy="45" r="20" fill="#00ff88"/>
                        <ellipse cx="60" cy="95" rx="25" ry="20" fill="#00ff88"/>
                        <defs>
                            <linearGradient id="avatarGradient" x1="0" y1="0" x2="120" y2="120">
                                <stop offset="0%" stop-color="#ff0099" stop-opacity="0.3"/>
                                <stop offset="100%" stop-color="#00ff88" stop-opacity="0.3"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="avatar-glow"></div>
            </div>
            <div class="profile-info">
                <h1 class="profile-username" id="profileUsername">Hacker_User</h1>
                <p class="profile-bio" id="profileBio" contenteditable="false">Cybersecurity enthusiast | Penetration Tester | Bug Hunter</p>
                <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
            </div>
        </div>

        <!-- Genel Ä°lerleme Paneli BÃ¶lÃ¼mÃ¼ -->
        <div class="progress-panel">
            <h2 class="section-title">Overall Progress</h2>
            <div class="progress-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalProgress">68%</div>
                    <div class="stat-label">Total Completion</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="totalProgressBar">
                            <div class="progress-fill" style="width: 68%"></div>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coursesCompleted">5</div>
                    <div class="stat-label">Courses Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coursesInProgress">3</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalHours">127</div>
                    <div class="stat-label">Hours Learned</div>
                </div>
            </div>
        </div>

        <!-- Dersleri BÃ¶lÃ¼mÃ¼ -->
        <div class="courses-section">
            <h2 class="section-title">My Courses</h2>
            <div class="courses-grid" id="coursesGrid">
                <!-- Course cards will be dynamically generated -->
            </div>
        </div>

        <!-- Ã–dÃ¼lleri(bagde) BÃ¶lÃ¼mÃ¼ -->
        <div class="badges-section">
            <h2 class="section-title">Earned Badges</h2>
            <div class="badges-grid" id="badgesGrid">
                <!-- Ã–dÃ¼lleri(bagde) dinamik olarak oluÅŸturulacak -->
            </div>
        </div>

        <!-- Son Aktivite Zaman Ã‡izelgesi BÃ¶lÃ¼mÃ¼ -->
        <div class="activity-section">
            <h2 class="section-title">Recent Activity</h2>
            <div class="activity-timeline" id="activityTimeline">
                <!-- Activity items will be dynamically generated -->
            </div>
        </div>

        <!-- GÃ¼venlik AyarlarÄ± BÃ¶lÃ¼mÃ¼ -->
        <div class="security-section">
            <h2 class="section-title">Security Settings</h2>
            <div class="security-options">
                <div class="security-item">
                    <div class="security-info">
                        <h3>Two-Factor Authentication</h3>
                        <p>Add an extra layer of security to your account</p>
                    </div>
                    <button class="security-btn">Enable 2FA</button>
                </div>
                <div class="security-item">
                    <div class="security-info">
                        <h3>Change Password</h3>
                        <p>Update your account password</p>
                    </div>
                    <button class="security-btn">Change Password</button>
                </div>
                <div class="security-item">
                    <div class="security-info">
                        <h3>Account Settings</h3>
                        <p>Manage your account preferences</p>
                    </div>
                    <button class="security-btn">Settings</button>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script>
        // Ã–rnek veriler - GerÃ§ek API Ã§aÄŸrÄ±larÄ± ile deÄŸiÅŸtirilecek
        const sampleCourses = [
            {
                id: 1,
                title: "Ethical Hacking Fundamentals",
                category: "Penetration Testing",
                progress: 85,
                thumbnail: "ðŸ”“"
            },
            {
                id: 2,
                title: "Network Security Essentials",
                category: "Network Security",
                progress: 60,
                thumbnail: "ðŸŒ"
            },
            {
                id: 3,
                title: "Web Application Security",
                category: "Web Security",
                progress: 45,
                thumbnail: "ðŸ•·ï¸"
            },
            {
                id: 4,
                title: "Cryptography Basics",
                category: "Cryptography",
                progress: 30,
                thumbnail: "ðŸ”"
            },
            {
                id: 5,
                title: "Malware Analysis",
                category: "Reverse Engineering",
                progress: 20,
                thumbnail: "ðŸ¦ "
            }
        ];

        const sampleBadges = [
            { name: "First Steps", icon: "ðŸŽ¯", description: "Completed your first course" },
            { name: "Quick Learner", icon: "âš¡", description: "Completed 3 courses in a week" },
            { name: "Security Expert", icon: "ðŸ›¡ï¸", description: "Mastered 5 security courses" },
            { name: "Night Owl", icon: "ðŸ¦‰", description: "Learned 50 hours after midnight" }
        ];

        const sampleActivities = [
            { action: "Completed 85% of", course: "Ethical Hacking Fundamentals", time: "2 hours ago" },
            { action: "Started", course: "Malware Analysis", time: "1 day ago" },
            { action: "Earned badge", course: "Security Expert", time: "3 days ago" },
            { action: "Completed 60% of", course: "Network Security Essentials", time: "5 days ago" },
            { action: "Completed", course: "Web Application Security - Module 2", time: "1 week ago" }
        ];

        // Load user data from localStorage or API -> localStorage'dan veya API'den kullanÄ±cÄ± verilerini yÃ¼kle
        async function loadUserData() {
            // Try to get user data from localStorage (set during login) -> localStorage'dan kullanÄ±cÄ± verilerini yÃ¼kle
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            if (userData.nickname) {
                document.getElementById('profileUsername').textContent = userData.nickname;
            }
            
            // API'den veri Ã§ekmek iÃ§in kullanÄ±cÄ± ID'si varsa
            if (userData.id) {
                try {
                    const response = await fetch(`http://localhost:3000/api/user/${userData.id}`);
                    const data = await response.json();
                    
                    if (data.success && data.user) {
                        updateProfile(data.user);
                    }
                } catch (error) {
                    console.error('Error fetching user data:', error);
                    // localStorage verilerine geri dÃ¶nÃ¼ÅŸ
                    if (userData.nickname) {
                        document.getElementById('profileUsername').textContent = userData.nickname;
                    }
                }
            }
        }

        // Profili gÃ¼ncelleme
        function updateProfile(user) {
            if (user.nickname) {
                document.getElementById('profileUsername').textContent = user.nickname;
            }
            if (user.bio) {
                document.getElementById('profileBio').textContent = user.bio;
            }
        }

        // Dersleri gÃ¶rÃ¼ntÃ¼leme
        function renderCourses() {
            const grid = document.getElementById('coursesGrid');
            grid.innerHTML = sampleCourses.map(course => `
                <div class="course-card">
                    <div class="course-thumbnail">${course.thumbnail}</div>
                    <div class="course-content">
                        <div class="course-category">${course.category}</div>
                        <h3 class="course-title">${course.title}</h3>
                        <div class="course-progress">
                            <div class="progress-info">
                                <span>Progress</span>
                                <span>${course.progress}%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${course.progress}%"></div>
                                </div>
                            </div>
                        </div>
                        <button class="continue-btn" onclick="continueCourse(${course.id})">Continue</button>
                    </div>
                </div>
            `).join('');
        }

        //Ã–dÃ¼lleri(bagde) gÃ¶rÃ¼ntÃ¼leme
        function renderBadges() {
            const grid = document.getElementById('badgesGrid');
            grid.innerHTML = sampleBadges.map(badge => `
                <div class="badge-card">
                    <div class="badge-icon">${badge.icon}</div>
                    <h4 class="badge-name">${badge.name}</h4>
                    <p class="badge-description">${badge.description}</p>
                </div>
            `).join('');
        }

        // Aktivite zaman Ã§izelgesini gÃ¶rÃ¼ntÃ¼leme
        function renderActivity() {
            const timeline = document.getElementById('activityTimeline');
            timeline.innerHTML = sampleActivities.map(activity => `
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <p><span class="activity-action">${activity.action}</span> <span class="activity-course">${activity.course}</span></p>
                        <span class="activity-time">${activity.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // profil dÃ¼zenleme iÅŸlemi
        document.getElementById('editProfileBtn').addEventListener('click', async function() {
            const bio = document.getElementById('profileBio');
            const isEditable = bio.contentEditable === 'true';
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            if (isEditable) {
                // bio'yÄ± kaydet
                bio.contentEditable = 'false';
                this.textContent = 'Edit Profile';
                this.disabled = true;
                
                // bio'yÄ± backend'e kaydet
                if (userData.id) {
                    try {
                        const response = await fetch(`http://localhost:3000/api/user/${userData.id}/bio`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ bio: bio.textContent })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            console.log('Bio saved successfully');
                        }
                    } catch (error) {
                        console.error('Error saving bio:', error);
                    }
                }
                
                this.disabled = false;
            } else {
                bio.contentEditable = 'true';
                bio.focus();
                this.textContent = 'Save';
            }
        });

        function continueCourse(courseId) {
            // Ders sayfasÄ±na yÃ¶nlendir
            console.log('Continue course:', courseId);
            // window.location.href = `course.html?id=${courseId}`;
        }

        // Navbar'Ä± gÃ¼ncelle ve profil linkini gÃ¶ster
        function updateNavbar() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            if (userData.id) {
                // GiriÅŸ/KayÄ±t dÃ¼ÄŸmelerini gÃ¼ncelle ve profil linkini gÃ¶ster
                const loginRegisterDiv = document.querySelector('.login-register');
                if (loginRegisterDiv) {
                    loginRegisterDiv.innerHTML = `
                        <button onclick="window.location.href='profile.html'">PROFÄ°L</button>
                        <button onclick="logout()">Ã‡IKIÅž</button>
                    `;
                }
            }
        }

        // Ã‡Ä±kÄ±ÅŸ iÅŸlemini gerÃ§ekleÅŸtir
        function logout() {
            localStorage.removeItem('userData');
            window.location.href = '../../index.html';
        }

        // Ã‡Ä±kÄ±ÅŸ iÅŸlemini global olarak kullanÄ±labilir hale getir
        window.logout = logout;

        // SayfayÄ± baÅŸlat
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            renderCourses();
            renderBadges();
            renderActivity();
            
            // Navbar'Ä±n yÃ¼klenmesini bekle, ardÄ±ndan gÃ¼ncelle
            setTimeout(updateNavbar, 500);
        });
    </script>
</body>
</html>

